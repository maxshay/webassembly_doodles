<!DOCTYPE html>
<html>
  <head>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl"
      crossorigin="anonymous"
    />
  </head>
  <body class="bg-light m-0 p-0">
    <div class="container mt-4">
      <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
          <ul class="navbar-nav me-auto mb-2">
            <li class="nav-item">
              <a class="nav-link" href="/">home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/game.html">game</a>
            </li>
            <li class="nav-item">
              <a class="nav-link disabled" href="/graphics.html">graphics</a>
            </li>
          </ul>
        </div>
      </nav>
    </div>
    <div class="container overflow-auto border rounded bg-white p-5">
      <h1>Canvas demo</h1>
      <canvas id="demo-canvas"></canvas>
    </div>

    <script>
      async function init() {
        const { instance } = await WebAssembly.instantiateStreaming(
          fetch("./graphics.wasm")
        );

        const width = 600;
        const height = 600;
        const CANVAS = document.getElementById("demo-canvas");

        CANVAS.style.width = `${width}px`;
        CANVAS.style.height = `${height}px`;

        const buffer_address = instance.exports.BUFFER.value;

        const imageData = new Uint8ClampedArray(
          instance.exports.memory.buffer,
          buffer_address,
          4 * width * height
        );

        const image = new ImageData(imageData, width);
        const ctx = CANVAS.getContext("2d");
        instance.exports.go();

        ctx.putImageData(image, 0, 0);
      }

      init();
    </script>
  </body>
</html>
